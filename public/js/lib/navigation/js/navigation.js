define(function(){function t(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function e(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function n(n,i,s,r){var o,l;return l=e(i),l.ns&&(o=t(l.ns)),n.filter(function(t){return!(!t||l.e&&t.e!==l.e||l.ns&&!o.test(t.ns)||s&&t.cb!==s&&t.cb._cb!==s||r&&t.ctx!==r)})}function i(t,e){return this instanceof i?(e&&$.extend(this,e),this.type=t,this):new i(t,e)}var s=function(t){this.settings=$.extend({},s.defaults,t),this.init()};s.prototype={init:function(){this._create()},_create:function(){var t,e,n=this,i=n.settings,s=i.navListObj,r=s.find("ul").first(),o="ui-navigator";n.prevIndex,!r.length&&i.content?(r=$(n.tpl2html("list")),t=n.tpl2html("item"),e="",i.content.forEach(function(n){n=$.extend({href:"",text:""},"string"==typeof n?{text:n}:n),e+=t(n)}),r.append(e).appendTo(s)):(s.is("ul, ol")&&(r=s.wrap("<div>"),s=s.parent()),void 0===i.index&&(i.index=r.find(".ui-state-active").index(),~i.index||(i.index=0))),n.$list=r.addClass(o+"-list"),n.trigger("done",s.addClass(o),i),n.bindEvent(),n.index=-1,n.switchTo(i.index)},_switchTo:function(t,e){if(t!==this.index){var n,s=this,r=s.$list.children(),o=i("beforeselect",e);return s.trigger(o,r.get(t)),n=r.removeClass("ui-state-active").eq(t).addClass("ui-state-active"),s.index=t,s.select(t,n[0])}},switchTo:function(t){return this._switchTo(~~t)},select:function(t,e){var n=this,i=n.settings;void 0===n.prevIndex&&(n.prevIndex=n.index?0:1);var s,r=t>n.prevIndex,o=$(e)[r?"next":"prev"](),l=o.offset()||$(e).offset(),c=i.navListObj.offset();(r?l.left+l.width>c.left+c.width:l.left<c.left)&&(s=n.$list.offset(),i.navListObj.iScroll("scrollTo",r?c.width-l.left+s.left-l.width:s.left-l.left,0,400)),n.prevIndex=t},unselect:function(){this.index=-1,this.$list.children().removeClass("ui-state-active")},getIndex:function(){return this.index},trigger:function(t){var e,s,r,o,l,c=-1;if(!this._events||!t)return this;if("string"==typeof t&&(t=new i(t)),e=slice.call(arguments,1),t.args=e,e.unshift(t),s=n(this._events,t.type))for(o=s.length;++c<o;)if((r=t.isPropagationStopped())||!1===(l=s[c]).cb.apply(l.ctx2,e)){r||(t.stopPropagation(),t.preventDefault());break}return this},refresh:function(){this.settings.navListObj.iScroll("refresh")},bindEvent:function(){var t,e,n=this,i=n.settings,s=i.navListObj,r=s.find("ul").first(),o=$(document),l=function(){var n=t.attr("hl-cls");clearTimeout(e),t.removeClass(n).removeAttr("hl-cls"),t=null,o.off("touchend touchmove touchcancel",l)},c=function(n,i){return $(i).each(function(){var s=$(this);s.css("-webkit-tap-highlight-color","rgba(255,255,255,0)").off("touchstart.hl"),n&&s.on("touchstart.hl",function(r){var c;t=i?(c=$(r.target).closest(i,this))&&c.length&&c:s,t&&(t.attr("hl-cls",n),e=setTimeout(function(){t.addClass(n)},100),o.on("touchend touchmove touchcancel",l))})})};c("ui-state-hover","li"),r.delegate("li:not(.ui-state-disable)>a","click",function(t){n._switchTo($(this).parent().index(),t)}),$(window).on("resize",function(){n.refresh()}),s.on("destroy",function(){s.iScroll("destroy"),$(window).off("resize")})}},s.defaults={navListObj:null,iScroll:{hScroll:!0,vScroll:!1,hScrollbar:!1,vScrollbar:!1},content:null,isScrollToNext:!0};var r=function(t){new s(t)};window.rNavigation=$.rNavigation=$.navigation=r});