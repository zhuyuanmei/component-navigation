define(function(t){function e(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function n(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function a(t,a,i,r){var s,o;return o=n(a),o.ns&&(s=e(o.ns)),t.filter(function(t){return!(!t||o.e&&t.e!==o.e||o.ns&&!s.test(t.ns)||i&&t.cb!==i&&t.cb._cb!==i||r&&t.ctx!==r)})}function i(t,e){return this instanceof i?(e&&$.extend(this,e),this.type=t,this):new i(t,e)}var r=t("mustache"),s={navigatorItemsCont:["{{#navigatorItems}}",'<li class="base-info">','<div class="base-info-lt">','<img src="{{url}}">',"</div>",'<div class="base-info-rt">','<div class="base-info-rt-hd">','<div class="user-name"><span>{{name}}</span>{{post}}</div>',"</div>",'<div class="user-phone"><span class="hospital">{{hospital}}</span><span class="department">{{department}}</span></div>','<div class="desc">简介：{{intro}}</div>',"</div>","</li>","{{/navigatorItems}}"]},o=function(t,e){t.show(),t.text(e),setTimeout(function(){t.removeClass("error-tip"),t.addClass("error-tip-fade"),setTimeout(function(){t.removeClass("error-tip-fade"),t.addClass("error-tip"),t.hide()},500)},2e3)},l=function(t){this.settings=$.extend({},l.defaults,t),this.init()};l.prototype={init:function(){this._create()},_create:function(){var t,e,n=this,a=n.settings,i=a.navListObj,r=i.find("ul").first(),s="ui-navigator";n.prevIndex,!r.length&&a.content?(r=$(n.tpl2html("list")),t=n.tpl2html("item"),e="",a.content.forEach(function(n){n=$.extend({href:"",text:""},"string"==typeof n?{text:n}:n),e+=t(n)}),r.append(e).appendTo(i)):(i.is("ul, ol")&&(r=i.wrap("<div>"),i=i.parent()),void 0===a.index&&(a.index=r.find(".ui-state-active").index(),~a.index||(a.index=0))),n.$list=r.addClass(s+"-list"),n.trigger("done",i.addClass(s),a),n.bindEvent(),n.index=-1,n.switchTo(a.index)},_switchTo:function(t,e){if(t!==this.index){var n,a=this,r=a.$list.children(),s=i("beforeselect",e);return a.trigger(s,r.get(t)),n=r.removeClass("ui-state-active").eq(t).addClass("ui-state-active"),a.index=t,a.select(t,n[0])}},switchTo:function(t){return this._switchTo(~~t)},select:function(t,e){var n=this,a=n.settings;void 0===n.prevIndex&&(n.prevIndex=n.index?0:1);var i,l=t>n.prevIndex,c=$(e)[l?"next":"prev"](),d=c.offset()||$(e).offset(),u=a.navListObj.offset();(l?d.left+d.width>u.left+u.width:d.left<u.left)&&(i=n.$list.offset(),a.navListObj.iScroll("scrollTo",l?u.width-d.left+i.left-d.width:i.left-d.left,0,400)),n.prevIndex=t;var h=n.$list.children().eq(t),f=h.attr("data-id"),v=h.attr("data-url"),g=parseInt(h.attr("data-maxPage"));a.navItemContentObj.attr("data-curPage","2"),$.ajax({type:"post",url:v,data:{categoryId:f,page:1},dataType:"json",success:function(t){if(t.flag)if(t.navigatorItems.length){var e={navigatorItems:t.navigatorItems},i=r.render(s.navigatorItemsCont.join(""),e);a.navItemContentObj.html(i),1>=g?(a.refreshDownObj.hide(),n.disable("down",!0)):(a.refreshDownObj.show(),n._setStyle("down","loaded"),n.enable("down"))}else a.navItemContentObj.html('<div style="text-align:center;margin-top:80px;color:#A54093;font-size:20px;">暂无数据</div>'),a.refreshDownObj.hide(),n.disable("down",!0);else o(a.errorTipObj,t.msg)},error:function(){o(a.errorTipObj,"请求服务器异常,稍后再试")}})},unselect:function(){this.index=-1,this.$list.children().removeClass("ui-state-active")},getIndex:function(){return this.index},trigger:function(t){var e,n,r,s,o,l=-1;if(!this._events||!t)return this;if("string"==typeof t&&(t=new i(t)),e=slice.call(arguments,1),t.args=e,e.unshift(t),n=a(this._events,t.type))for(s=n.length;++l<s;)if((r=t.isPropagationStopped())||!1===(o=n[l]).cb.apply(o.ctx2,e)){r||(t.stopPropagation(),t.preventDefault());break}return this},refresh:function(){this.settings.navListObj.iScroll("refresh")},_changeStyle:function(t,e){var n=this.settings;switch(e){case"loaded":n.refreshLabelObj.html("加载更多"),n.refreshIconObj.removeClass(),n._actDir="";break;case"loading":n.refreshLabelObj.html("加载中..."),n.refreshIconObj.addClass("ui-loading"),n._actDir=t;break;case"disable":n.refreshLabelObj.html("没有更多内容了")}return this},_setStyle:function(t,e){var n=this,a=$.Event("statechange");return n.trigger(a,n.settings["$"+t+"Elem"],e,t),a.defaultPrevented?n:n._changeStyle(t,e)},_status:function(t,e){var n=this.settings;return void 0===e?n["_"+t+"Open"]:n["_"+t+"Open"]=!!e},_setable:function(t,e,n){var a=this,i=a.settings,r=i.refreshDownObj;return r.length?(t?r.show():n?r.hide():a._setStyle(e,"disable"),a._status(e,t),a):void 0},disable:function(t,e){return this._setable(!1,t,e)},enable:function(t){return this._setable(!0,t)},_loadingAction:function(t,e){var n=this,a=(n.settings,n.load);return $.isFunction(a)&&a.call(n,t,e),n._status(t,!1),n},afterDataLoading:function(t){var e=this,t=t||e.settings._actDir;return e._setStyle(t,"loaded"),e._status(t,!0),e},load:function(t){var e=this,n=e.settings.navItemContentObj;parseInt($("li.ui-state-active").attr("data-maxPage"))>=parseInt(n.attr("data-curPage"))&&"down"===t&&$.ajax({type:"post",url:$("li.ui-state-active").attr("data-url"),data:{categoryId:$("li.ui-state-active").attr("data-id"),page:parseInt(n.attr("data-curPage"))},dataType:"json",success:function(t){parseInt($("li.ui-state-active").attr("data-maxPage"))>=parseInt(n.attr("data-curPage"))&&setTimeout(function(){var a=r.render(s.navigatorItemsCont.join(""),t);n.append(a),e.afterDataLoading(),n.attr("data-curPage",parseInt(n.attr("data-curPage"))+1),parseInt(n.attr("data-curPage"))>parseInt($("li.ui-state-active").attr("data-maxPage"))&&e.disable("down",!0)},500)},error:function(){o(e.settings.errorTipObj,"请求服务器异常,稍后再试")}})},_startHandler:function(t){this.settings._startY=t.touches[0].pageY},_endHandler:function(){var t=this,e=t.settings;return t._setStyle("down","loading"),t._loadingAction("down","pull"),e._refreshing=!1,t},_moveHandler:function(t){var e=this,n=e.settings,a=n._startY,i=a-t.touches[0].pageY,r=n._win.innerHeight,s=n.threshold||(n.wrapperH<r?n.wrapperH/2+n.wrapperTop||0:r/2);if(e._status("down")&&!(0>i))return!n._refreshing&&a>=n._body.scrollHeight-r+s&&i>10&&(e._setStyle("down","beforeload"),n._refreshing=!0),e},_eventHandler:function(t){var e=this,n=e.settings;switch(t.type){case"touchstart":e._startHandler(t);break;case"touchmove":clearTimeout(n._endTimer),n._endTimer=setTimeout(function(){e._endHandler()},300),e._moveHandler(t);break;case"touchend":case"touchcancel":clearTimeout(n._endTimer),n._refreshing&&e._endHandler();break;case"scrollStop":!n._refreshing&&n._win.pageYOffset>=n._body.scrollHeight-n._win.innerHeight+(n.threshold||-1)&&e._endHandler()}return e},bindEvent:function(){var t,e,n=this,a=n.settings,i=a.navListObj,r=i.find("ul").first(),s=$(document),o=function(){var n=t.attr("hl-cls");clearTimeout(e),t.removeClass(n).removeAttr("hl-cls"),t=null,s.off("touchend touchmove touchcancel",o)},l=function(n,a){return $(a).each(function(){var i=$(this);i.css("-webkit-tap-highlight-color","rgba(255,255,255,0)").off("touchstart.hl"),n&&i.on("touchstart.hl",function(r){var l;t=a?(l=$(r.target).closest(a,this))&&l.length&&l:i,t&&(t.attr("hl-cls",n),e=setTimeout(function(){t.addClass(n)},100),s.on("touchend touchmove touchcancel",o))})})};l("ui-state-hover","li"),r.delegate("li:not(.ui-state-disable)>a","click",function(t){n._switchTo($(this).parent().index(),t)}),$(window).on("resize",function(){n.refresh()}),i.on("destroy",function(){i.iScroll("destroy"),$(window).off("resize")}),i.iScroll(a.iScrollArg),a.pullAreaObj.on("touchstart touchmove touchend touchcancel",function(t){a.wrapperH=a.pullAreaObj.height(),a.wrapperTop=a.pullAreaObj.offset().top,a._win=window,a._body=document.body,n._eventHandler(t)})}},l.defaults={navListObj:null,navItemContentObj:null,pullAreaObj:null,refreshDownObj:null,refreshIconObj:null,refreshLabelObj:null,errorTipObj:null,iScrollArg:{hScroll:!0,vScroll:!1,hScrollbar:!1,vScrollbar:!1,bounce:!1},content:null,isScrollToNext:!0};var c=function(t){new l(t)};window.rNavigation=$.rNavigation=$.navigation=c});