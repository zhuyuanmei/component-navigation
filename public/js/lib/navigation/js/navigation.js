define(function(){function t(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function e(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function i(i,n,s,r){var o,l;return l=e(n),l.ns&&(o=t(l.ns)),i.filter(function(t){return!(!t||l.e&&t.e!==l.e||l.ns&&!o.test(t.ns)||s&&t.cb!==s&&t.cb._cb!==s||r&&t.ctx!==r)})}function n(t,e){return this instanceof n?(e&&$.extend(this,e),this.type=t,this):new n(t,e)}var s=function(t){this.settings=$.extend({},s.defaults,t),this.init()};s.prototype={init:function(){this._create()},_create:function(){prevIndex=0;var t,e,i=this,n=i.settings,s=n.navListObj,r=s.find("ul").first(),o="ui-navigator";!r.length&&n.content?(r=$(i.tpl2html("list")),t=i.tpl2html("item"),e="",n.content.forEach(function(i){i=$.extend({href:"",text:""},"string"==typeof i?{text:i}:i),e+=t(i)}),r.append(e).appendTo(s)):(s.is("ul, ol")&&(r=s.wrap("<div>"),s=s.parent()),void 0===n.index&&(n.index=r.find(".ui-state-active").index(),~n.index||(n.index=0))),i.$list=r.addClass(o+"-list"),i.trigger("done",s.addClass(o),n);var l=$('<div class="ui-scroller"></div>');s.html(l),l.html(r),i.bindEvent(),i.index=-1,i.switchTo(n.index)},_switchTo:function(t,e){if(t!==this.index){var i,s=this,r=s.$list.children(),o=n("beforeselect",e);return s.trigger(o,r.get(t)),i=r.removeClass("ui-state-active").eq(t).addClass("ui-state-active"),s.index=t,s.select(t,i[0])}},switchTo:function(t){return this._switchTo(~~t)},select:function(t,e){var i=this,n=i.settings;void 0===prevIndex&&(prevIndex=i.index?0:1);var s,r=t>prevIndex,o=$(e)[r?"next":"prev"](),l=o.offset()||$(e).offset(),c=n.navListObj.offset();(r?l.left+l.width>c.left+c.width:l.left<c.left)&&(s=i.$list.offset(),n.navListObj.iScroll("scrollTo",r?c.width-l.left+s.left-l.width:s.left-l.left,0,400)),prevIndex=t},unselect:function(){this.index=-1,this.$list.children().removeClass("ui-state-active")},getIndex:function(){return this.index},trigger:function(t){var e,s,r,o,l,c=-1;if(!this._events||!t)return this;if("string"==typeof t&&(t=new n(t)),e=slice.call(arguments,1),t.args=e,e.unshift(t),s=i(this._events,t.type))for(o=s.length;++c<o;)if((r=t.isPropagationStopped())||!1===(l=s[c]).cb.apply(l.ctx2,e)){r||(t.stopPropagation(),t.preventDefault());break}return this},refresh:function(){this.settings.navListObj.iScroll("refresh")},bindEvent:function(){var t,e,i=this,n=i.settings,s=n.navListObj,r=s.find("ul").first(),o=$(document),l=function(){var i=t.attr("hl-cls");clearTimeout(e),t.removeClass(i).removeAttr("hl-cls"),t=null,o.off("touchend touchmove touchcancel",l)},c=function(i,n){return $(n).each(function(){var s=$(this);s.css("-webkit-tap-highlight-color","rgba(255,255,255,0)").off("touchstart.hl"),i&&s.on("touchstart.hl",function(r){var c;t=n?(c=$(r.target).closest(n,this))&&c.length&&c:s,t&&(t.attr("hl-cls",i),e=setTimeout(function(){t.addClass(i)},100),o.on("touchend touchmove touchcancel",l))})})};c("ui-state-hover","li"),r.delegate("li:not(.ui-state-disable)>a","click",function(t){i._switchTo($(this).parent().index(),t)}),$(window).on("resize",function(){i.refresh()}),s.on("destroy",function(){s.iScroll("destroy"),$(window).off("resize")})}},s.defaults={navListObj:null,iScroll:{hScroll:!0,vScroll:!1,hScrollbar:!1,vScrollbar:!1},content:null,isScrollToNext:!0};var r=function(t){new s(t)};window.rNavigation=$.rNavigation=$.navigation=r});